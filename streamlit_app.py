import openai
import streamlit as st
import os

openai.api_key = st.secrets["openai_api_key"]

st.set_page_config(page_title="Bangla YouTube Script Generator", layout="centered")
st.title("ЁЯЗзЁЯЗй ржмрж╛ржВрж▓рж╛ ржЗржЙржЯрж┐ржЙржм рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЬрзЗржирж╛рж░рзЗржЯрж░")
st.markdown("ржкрзНрж░ржорзНржкржЯ ржжрж┐ржи, ржмрж╛ржВрж▓рж╛ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржкрзЗрзЯрзЗ ржпрж╛ржи!")

prompt = st.text_input("ЁЯФ╕ ржЖржкржирж╛рж░ ржнрж┐ржбрж┐ржУрж░ ржмрж┐рж╖рзЯ рж▓рж┐ржЦрзБржи (ржЙржжрж╛рж╣рж░ржг: 'ржЖрждрзНржо-ржирж┐ржпрж╝ржирзНрждрзНрж░ржгрзЗрж░ ржЧрзБрж░рзБрждрзНржм'):", "")

if st.button("тЬНя╕П рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи") and prompt:
    with st.spinner("рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ, ржПржХржЯрзБ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи..."):
        try:
            response = openai.ChatCompletion.create(
                model="gpt-4",
                messages=[
                    {"role": "system", "content": "рждрзБржорж┐ ржПржХржЬржи ржкрзЗрж╢рж╛ржжрж╛рж░ ржЗржЙржЯрж┐ржЙржм рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж▓рзЗржЦржХред ржмрж╛ржВрж▓рж╛рзЯ рж╕рж╣ржЬ, ржЕржирзБржкрзНрж░рзЗрж░ржгрж╛ржорзВрж▓ржХ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж▓рзЗржЦрзЛред"},
                    {"role": "user", "content": f"{prompt} ржмрж┐рж╖рзЯрзЗ ржПржХржЯрж┐ рзи-рзй ржорж┐ржирж┐ржЯрзЗрж░ ржмрж╛ржВрж▓рж╛ ржЗржЙржЯрж┐ржЙржм рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж▓рзЗржЦрзЛред"}
                ],
                temperature=0.7
            )
            script = response['choices'][0]['message']['content']
            st.success("тЬЕ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рждрзИрж░рж┐ рж╣рзЯрзЗржЫрзЗ!")
            st.text_area("ЁЯУЬ ржирж┐ржЪрзЗ ржЖржкржирж╛рж░ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ:", script, height=300)

            if not os.path.exists("scripts"):
                os.makedirs("scripts")
            with open("scripts/generated_script.txt", "w", encoding="utf-8") as f:
                f.write(script)
        except Exception as e:
            st.error(f"тЭМ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ: {e}")
